{% extends 'base.html.twig' %}

{% block title %}Hello ProductController!{% endblock %}
{% block body %}

    <h1>Add Delivery</h1>
<form id='my-form' action="{{ path('app_user_add_delivery', {'id': id }) }}" method="POST">

    <input type='checkbox' id='personal_pickup' name='personal_pickup' value='personal_pickup'>
    <label for='personal_pickup'>  personal_pickup </label><br>
    <div id='location'></div>
    <div id='button'></div>
    <div id='notification'></div>
    <div id='addedLocation'>

    </div>
    <input type='checkbox' id='parcel_locker' name='parcel_locker' value='parcel_locker'>
    <label for='parcel_locker'>  parcel_locker 5$ </label><br>
    <input type='checkbox' id='courier' name='courier' value='courier'>
    <label for='courier'>  courier 10$ </label><br>
    <input type="hidden" name="my_array[]" id="my_array" value="" />
    <input type="submit" value="ss" />
    </form>



{% block javascripts %}
<script type="text/javascript">
$('input[type=checkbox]#personal_pickup').click(function(){
    if($(this).is(':checked')){
        $('#location').html('Pickup Location<input id="location-text" type="text">');
        $('#button').html('<div class="btn btn-primary">Add Pickup Location</div>');
    }
    else
    {
        $('#location').empty();
        $('#button').empty();
    }
});
var addedLocation = [];
$('#button').click(function(){
    var add = $('#location-text').val();
    if(addedLocation.includes(add) || add=='')
    {
        showNotification('lokacja ju≈º istnieje');
    }
    else
    {
        addedLocation.push(add);
        refreshAddedLocation();
    }
    console.log(addedLocation);
});
function refreshAddedLocation()
{
    $('#addedLocation').empty();
    for (var i = 0; i < addedLocation.length; i++){
        var location = addedLocation[i];
        $('#addedLocation').append(location + '<div data-id="'+location+'" class="deleteDelivery btn fa-sharp fa-solid fa-xmark" ></div><br>');
    }
    $('#my_array').val(JSON.stringify(addedLocation));
    console.log($('#my_array').val());
}
function showNotification(message)
{
    $('#notification').html(message);
    setTimeout(function()
    {
        $('#notification').get(0).style.display = 'none';
        console.log(1111);
    }, 2000);
}

canCallFunction2 = true;
$(document).on("click", ".deleteDelivery",function(){
       event.preventDefault();
    if (canCallFunction2) {
      canCallFunction2 = false;
      setTimeout(() => {
        canCallFunction2 = true;
      }, 500);
    var $button = $(this);
    var deliveryLocation = $button.data('id');
    var deleteDelivery = addedLocation.indexOf(deliveryLocation);
    console.log(deleteDelivery);
    addedLocation.splice(deleteDelivery, 1);
    console.log(addedLocation);
    refreshAddedLocation();
    }
});



</script>
{% endblock %}
{% endblock %}
