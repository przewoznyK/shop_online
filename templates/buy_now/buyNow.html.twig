{% extends 'base.html.twig' %}

{% block title %}Hello BuyNowController!{% endblock %}

{% block body %}
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v7.2.2/ol.css">
<script src="https://cdn.jsdelivr.net/npm/ol@v7.2.2/dist/ol.js"></script>
<style>
#map {
    position: absolute;
    top: 0;
    bottom: 0;
    height: 400px;
    width: 50%;
}
</style>
    <div id='map'></div>
    <div id='popup'>
      <div id='popup-content'></div>
    </div>
{% block javascripts %}
<script type="text/javascript">

const key = 'dWCVxevJpUtedw46MjwC';
const source = new ol.source.TileJSON({
  url: `https://api.maptiler.com/maps/streets-v2/tiles.json?key=${key}`,
  tileSize: 512,
  crossOrigin: 'anonymous'
});

const attribution = new ol.control.Attribution({
  collapsible: false,
});

const map = new ol.Map({
  layers: [
    new ol.layer.Tile({
      source: source
    })
  ],
  target: 'map',
  view: new ol.View({
    constrainResolution: true,
    center: ol.proj.fromLonLat([16.62662018, 52.2125578]),
    zoom: 5
  })
});

const Airports = new ol.layer.Vector({
    source: new ol.source.Vector({
        url: 'https://api.maptiler.com/data/9874a5e8-c0f7-4a7f-989a-c5f44fd25e26/features.json?key=dWCVxevJpUtedw46MjwC',
        format: new ol.format.GeoJSON(),
    })
})
map.addLayer(Airports);

var container = $('#popup');
var content = $('#popup-content');
var content_element = $('#popup-content');

// PopUp
var overlaydet = new ol.Overlay({
  element: document.getElementById('popup'),
  positioning: 'bottom-center',
});
map.addOverlay(overlaydet);


map.on('click', function(evt){
  $('#popup-content').empty();
  var feature1=map.forEachFeatureAtPixel(evt.pixel,
    function(feature1){
      return feature1;
    })
    if(feature1){
      const coord = feature1.getGeometry().getCoordinates();
      const name = feature1.get('name');
      var content = '<h6>' + name + '</h6>';
      overlaydet.setPosition(coord);
      $('#popup-content').html(content);
    }
})


</script>
{% endblock %}

{% endblock %}
