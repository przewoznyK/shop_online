{% extends 'base.html.twig' %}

{% block title %}Hello BuyNowController!{% endblock %}

{% block body %}

{% for myOrders in myOrdersArray %}
<section class='order-field' data-id={{ myOrders.id }}

   Product: {{ myOrders.product }}<br>
   Price: {{ myOrders.price }}<br>

   Comment: {{ myOrders.comment }}<br>
   Delivery Type: {{ myOrders.deliveryType }}<br>

   
   Final Location: {{ myOrders.finalLocation }}<br>
   Name: {{ myOrders.name }}<br>
   Last Name: {{ myOrders.lastName }}<br>
   Email: {{ myOrders.email }}<br>
   Address: {{ myOrders.address }}<br>
   Phone Number: {{ myOrders.phoneNumber }}<br>
   Payment Method: {{ myOrders.paymentMethod }}<br>
   

   {% if (myOrders.isPaid) %}
   Paid 
   {% else %}
   Not Paid 
   {% endif %}
   <br>
    {{myOrders.status}}
    {% if not (myOrders.status == 'ready_to_pick_up') and not (myOrders.status == 'shipped') and not(myOrders.status == 'done') %}
        <div class='btn btn-danger delete-order' data-id='{{ myOrders.id }}'>Delete</div>
        <div class='btn btn-primary order ' data-status='{{myOrders.status}}' data-id='{{ myOrders.id }}' data-type='{{ myOrders.deliveryType }}'
        {% if (myOrders.status == 'pending') %} >Accept
        {% elseif (myOrders.status == 'processing') %} 
            {% if (myOrders.deliveryType == 'personal_pickup') %}>Ready to pick up
            {% elseif (myOrders.deliveryType == 'parcel_locker') %}>Shipped
            {% elseif (myOrders.deliveryType == 'courier') %}>Shipped
        {% endif %}
        {% endif %}
        </div>
    {% else %}
        <div> During shipment </div>
    {% endif %}
   <br>
   <hr>
</section>
{% endfor %}

{% block javascripts %}
{{ encore_entry_script_tags('app') }}
<script>
$(document).ready(function(){
    $('.order[data-status="ready_to_pick_up"]').attr('disabled', true);
})
$(document).on('click', '.order', function(){
    id = $(this).data('id');
    status = $(this).data('status');
    type = $(this).data('type');
    console.log(id);
    console.log(status);
    console.log(type);
    $.ajax({
        url: '{{ path('ajax_order_from_buyers') }}',
        method: 'POST',
        data: {id: id, status: status, type: type},
        success: function(response)
        {
            console.log(response.done);
            if(!response.done)
            {
                $('.order[data-id='+id+']').data('status', response.newStatus);
                $('.order[data-id='+id+']').text(response.newText);
            }
            else
            {
                $('.order[data-id='+id+']').attr('data-status', response.newStatus);
                $('.order[data-id='+id+']').text(response.newText).addClass('disabled');
                $('.delete-order[data-id='+id+']').remove();
            }
        }
    })
})

$(document).on('click', '.delete-order', function(){
    id = $(this).data('id');
    $.ajax({
        url: '{{ path('ajax_my_orders') }}',
        method: 'POST',
        data: {id: id, status: status},
        success: function(response)
        {
            console.log(response.id);
            $('.order-field[data-id='+id+']').remove();
        }
    })
})

</script>
{% endblock %}
{% endblock %}