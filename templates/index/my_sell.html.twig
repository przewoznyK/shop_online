{% extends 'base.html.twig' %}

{% block title %}Hello BuyNowController!{% endblock %}

{% block body %}
<section id='pending' class='border border-primary'>
<h1>Waiting for accept</h1>
{% for myOrders in myOrdersArray %}
{% if myOrders.status == 'pending' %}
<div class='order-field' data-id={{ myOrders.id }}>

    Product: {{ myOrders.product }}<br>
    Price: {{ myOrders.price }}<br>

    Comment: {{ myOrders.comment }}<br>
    Delivery Type: {{ myOrders.deliveryType }}<br>


    Final Location: {{ myOrders.finalLocation }}<br>
    Name: {{ myOrders.name }}<br>
    Last Name: {{ myOrders.lastName }}<br>
    Email: {{ myOrders.email }}<br>
    Address: {{ myOrders.address }}<br>
    Phone Number: {{ myOrders.phoneNumber }}<br>
    Payment Method: {{ myOrders.paymentMethod }}<br>
            Feedback:   {{ myOrders.feedback }}<br>
    Feedback info:     {{ myOrders.feedbackDescription }}<br>
    <div class='btn btn-danger delete-order' data-id='{{ myOrders.id }}'>Delete</div>
        <div class='btn btn-primary order ' data-status='{{myOrders.status}}' data-id='{{ myOrders.id }}' 
             data-type='{{ myOrders.deliveryType }}'>Accept</div>
    <br><br><br><br>

</div>
{% endif %}
{% endfor %}</section>
<section id='progressing' class='border border-secondary'>
<h1>In progress</h1>
{% for myOrders in myOrdersArray %}
{% if myOrders.status == 'progressing' %}
<div class='order-field' data-id={{ myOrders.id }}>

    Product: {{ myOrders.product }}<br>
    Price: {{ myOrders.price }}<br>

    Comment: {{ myOrders.comment }}<br>
    Delivery Type: {{ myOrders.deliveryType }}<br>


    Final Location: {{ myOrders.finalLocation }}<br>
    Name: {{ myOrders.name }}<br>
    Last Name: {{ myOrders.lastName }}<br>
    Email: {{ myOrders.email }}<br>
    Address: {{ myOrders.address }}<br>
    Phone Number: {{ myOrders.phoneNumber }}<br>
    Payment Method: {{ myOrders.paymentMethod }}<br>
            Feedback:   {{ myOrders.feedback }}<br>
    Feedback info:     {{ myOrders.feedbackDescription }}<br>
    <div class='btn btn-danger delete-order' data-id='{{ myOrders.id }}'>Delete</div>
        <div class='btn btn-primary order ' data-status='{{myOrders.status}}' data-id='{{ myOrders.id }}' 
             data-type='{{ myOrders.deliveryType }}'
                         {% if (myOrders.deliveryType == 'personal_pickup') %}>Ready to pick up
            {% elseif (myOrders.deliveryType == 'parcel_locker') %}>Shipped
            {% elseif (myOrders.deliveryType == 'courier') %}>Shipped
            {% endif %}
            </div>
    <br><br><br><br>

</div>
{% endif %}
{% endfor %}</section>
<section id='ready_to_pick_up' class='border border-success'>
<h1> Ready to personal pick up </h1>
{% for myOrders in myOrdersArray %}
{% if myOrders.status == 'ready_to_pick_up' %}
<div class='order-field' data-id={{ myOrders.id }}>

    Product: {{ myOrders.product }}<br>
    Price: {{ myOrders.price }}<br>

    Comment: {{ myOrders.comment }}<br>
    Delivery Type: {{ myOrders.deliveryType }}<br>


    Final Location: {{ myOrders.finalLocation }}<br>
    Name: {{ myOrders.name }}<br>
    Last Name: {{ myOrders.lastName }}<br>
    Email: {{ myOrders.email }}<br>
    Address: {{ myOrders.address }}<br>
    Phone Number: {{ myOrders.phoneNumber }}<br>
    Payment Method: {{ myOrders.paymentMethod }}<br>
        Feedback:   {{ myOrders.feedback }}<br>
    Feedback info:     {{ myOrders.feedbackDescription }}<br>
    <br><br><br><br>

</div>
{% endif %}
{% endfor %}</section>

<section id='shipped' class='border border-success'>
<h1> Shipped </h1>
{% for myOrders in myOrdersArray %}
{% if myOrders.status == 'shipped' %}
<div class='order-field' data-id={{ myOrders.id }}>

    Product: {{ myOrders.product }}<br>
    Price: {{ myOrders.price }}<br>

    Comment: {{ myOrders.comment }}<br>
    Delivery Type: {{ myOrders.deliveryType }}<br>


    Final Location: {{ myOrders.finalLocation }}<br>
    Name: {{ myOrders.name }}<br>
    Last Name: {{ myOrders.lastName }}<br>
    Email: {{ myOrders.email }}<br>
    Address: {{ myOrders.address }}<br>
    Phone Number: {{ myOrders.phoneNumber }}<br>
    Payment Method: {{ myOrders.paymentMethod }}<br>
        Feedback:   {{ myOrders.feedback }}<br>
    Feedback info:     {{ myOrders.feedbackDescription }}<br>
    <br><br><br><br>

</div>
{% endif %}
{% endfor %}</section>


<section id='done' class='border border-success'>
<h1> Waiting for feedback </h1>
{% for myOrders in myOrdersArray %}
{% if myOrders.status == 'done' %}
<div class='order-field' data-id={{ myOrders.id }}>

    Product: {{ myOrders.product }}<br>
    Price: {{ myOrders.price }}<br>

    Comment: {{ myOrders.comment }}<br>
    Delivery Type: {{ myOrders.deliveryType }}<br>


    Final Location: {{ myOrders.finalLocation }}<br>
    Name: {{ myOrders.name }}<br>
    Last Name: {{ myOrders.lastName }}<br>
    Email: {{ myOrders.email }}<br>
    Address: {{ myOrders.address }}<br>
    Phone Number: {{ myOrders.phoneNumber }}<br>
    Payment Method: {{ myOrders.paymentMethod }}<br>
        Feedback:   {{ myOrders.feedback }}<br>
    Feedback info:     {{ myOrders.feedbackDescription }}<br>
    <br><br><br><br>

</div>
{% endif %}
{% endfor %}</section>

<section id='complete' class='border border-danger'>
<h1> Complete </h1>
{% for myOrders in myOrdersArray %}
{% if myOrders.status == 'feedback' and myOrders.feedback == 'ok'%}
<div class='order-field' data-id={{ myOrders.id }}>

    Product: {{ myOrders.product }}<br>
    Price: {{ myOrders.price }}<br>

    Comment: {{ myOrders.comment }}<br>
    Delivery Type: {{ myOrders.deliveryType }}<br>


    Final Location: {{ myOrders.finalLocation }}<br>
    Name: {{ myOrders.name }}<br>
    Last Name: {{ myOrders.lastName }}<br>
    Email: {{ myOrders.email }}<br>
    Address: {{ myOrders.address }}<br>
    Phone Number: {{ myOrders.phoneNumber }}<br>
    Payment Method: {{ myOrders.paymentMethod }}<br>
    Feedback:   {{ myOrders.feedback }}<br>
    Feedback info:     {{ myOrders.feedbackDescription }}<br>
    <br><br><br><br>
</div>
{% endif %}
{% endfor %}</section>

<section id='problem with the product' class='border border-warning'>
<h1> Problem with the product </h1>
{% for myOrders in myOrdersArray %}
{% if myOrders.status == 'feedback' and  myOrders.feedback != 'ok'%}
<div class='order-field' data-id={{ myOrders.id }}>

    Product: {{ myOrders.product }}<br>
    Price: {{ myOrders.price }}<br>

    Comment: {{ myOrders.comment }}<br>
    Delivery Type: {{ myOrders.deliveryType }}<br>


    Final Location: {{ myOrders.finalLocation }}<br>
    Name: {{ myOrders.name }}<br>
    Last Name: {{ myOrders.lastName }}<br>
    Email: {{ myOrders.email }}<br>
    Address: {{ myOrders.address }}<br>
    Phone Number: {{ myOrders.phoneNumber }}<br>
    Payment Method: {{ myOrders.paymentMethod }}<br>
    Feedback:   {{ myOrders.feedback }}<br>
    Feedback info:     {{ myOrders.feedbackDescription }}<br>
    <br><br><br><br>
</div>
{% endif %}
{% endfor %}</section>
{# {% for myOrders in myOrdersArray %}


<section class='order-field' data-id={{ myOrders.id }}>
    Product: {{ myOrders.product }}<br>
    Price: {{ myOrders.price }}<br>

    Comment: {{ myOrders.comment }}<br>
    Delivery Type: {{ myOrders.deliveryType }}<br>


    Final Location: {{ myOrders.finalLocation }}<br>
    Name: {{ myOrders.name }}<br>
    Last Name: {{ myOrders.lastName }}<br>
    Email: {{ myOrders.email }}<br>
    Address: {{ myOrders.address }}<br>
    Phone Number: {{ myOrders.phoneNumber }}<br>
    Payment Method: {{ myOrders.paymentMethod }}<br>


    {% if (myOrders.isPaid) %}
    Paid 
    {% else %}
    Not Paid 
    {% endif %}
    <br>
    {{myOrders.status}}
    {% if (myOrders.status == 'pending') or (myOrders.status == 'processing') %}
        <div class='btn btn-danger delete-order' data-id='{{ myOrders.id }}'>Delete</div>
        <div class='btn btn-primary order ' data-status='{{myOrders.status}}' data-id='{{ myOrders.id }}' data-type='{{ myOrders.deliveryType }}'
        {% if (myOrders.status == 'pending') %} >Accept
        {% elseif (myOrders.status == 'processing') %} 
            {% if (myOrders.deliveryType == 'personal_pickup') %}>Ready to pick up
            {% elseif (myOrders.deliveryType == 'parcel_locker') %}>Shipped
            {% elseif (myOrders.deliveryType == 'courier') %}>Shipped
        {% endif %}
        {% endif %}
        </div>
    {% elseif myOrders.status == 'feedback' %}:
         {{ myOrders.feedback }}
         {{ myOrders.feedbackDescription }}

    {% else %}
        <div> During shipment </div>
    {% endif %}
   <br>
   <hr>
</section>
{% endfor %} #}

{% block javascripts %}
{{ encore_entry_script_tags('app') }}
<script>
$(document).ready(function(){
    $('.order-field[data-status="ready_to_pick_up"]').attr('disabled', true);
})
$(document).on('click', '.order', function(){
    id = $(this).data('id');
    $(this).removeData('status');
    status = $(this).data('status');
    type = $(this).data('type');
    console.log(id);
    console.log(status);
    console.log(type);
    $.ajax({
        url: '{{ path('ajax_order_from_buyers') }}',
        method: 'POST',
        data: {id: id, status: status, type: type},
        success: function(response)
        {
            if(!response.done)
            {
                $('.order[data-id='+id+']').attr('data-status', response.newStatus);
                $('.order[data-id='+id+']').text(response.newText);
            }
            else
            {
                $('.order[data-id='+id+']').attr('data-status', response.newStatus);
                $('.order[data-id='+id+']').text(response.newText).addClass('disabled');
                $('.delete-order[data-id='+id+']').remove();
                $('.order[data-id='+id+']').remove();
            }

            $('.order-field[data-id='+id+']').appendTo($('section[id='+response.newStatus+']'));
        }
    })
})

$(document).on('click', '.delete-order', function(){
    id = $(this).data('id');
    $.ajax({
        url: '{{ path('ajax_my_orders') }}',
        method: 'POST',
        data: {id: id, status: status},
        success: function(response)
        {
            $('.order-field[data-id='+id+']').remove();
        }
    })
})

</script>
{% endblock %}
{% endblock %}