{% extends 'base.html.twig' %}

{% block title %}Hello UserPageController!
{% endblock %}

{% block body %}	

<section class="h-100" style="background-color: #eee;">
  <div class="container h-100 py-5">
    <div class="row d-flex justify-content-center align-items-center h-100">
      <div class="col-10">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h3 class="fw-normal mb-0 text-black">Shopping Cart</h3>
          <div>
            <p class="mb-0">
              <span class="text-muted">Sort by:</span>
              <a href="#!" class="text-body">price 
                <i class="fas fa-angle-down mt-1"></i>
              </a>
            </p>
          </div>
        </div>
      {% set count = 0 %}
	    {% for cartInfo in myCartsInfo %}
      <div class="cart-item" data-cart-id="{{ cartInfo.id }}">
        <div class="card rounded-3 mb-4">
          <div class="card-body p-4">
            <div class="row d-flex justify-content-between align-items-center">
              <div class="col-md-2 col-lg-2 col-xl-2">
              	<img src="{{ asset('users_data/' ~ myCartsDirImages[count]['id'] ~ '/products/' ~ myCartsDirImages[count]['dir'] ~ '/' ~ myCartsDirImages[count]['images'][0] ) }}" class="card-img-top" 
                     alt="{{ cartInfo.name }}-Image" class="img-fluid rounded-3">
              </div>
              <div class="col-md-3 col-lg-3 col-xl-3">
                <p class="lead fw-normal mb-2">{{ cartInfo.name }}</p>
              </div>
              <div class="col-md-3 col-lg-3 col-xl-2 d-flex">
                <input min="1" max="{{ cartInfo.quantity }}" data-display="#{{ cartInfo.id }}" value="{{ cartInfo.quantityUser  }}" type="number"
                  class="quantity-input form-control form-control-sm" data-price="{{ cartInfo.price }}" />
                  Max: {{ cartInfo.quantity }}<br>
              </div>
              <div class="col-md-3 col-lg-2 col-xl-2 offset-lg-1">
                <h5 class="mb-0">
                  <span id="{{ cartInfo.id }}">${{ cartInfo.price }}</span>
                </h5>
              </div>
              <div class="col-md-1 col-lg-1 col-xl-1 text-end">
                <a href="{{ path('app_check_product', { 'id': cartInfo.id }) }}" class="btn btn-primary">Check product</a>
                <a href="{{ path('app_buy_now', { 'productId': cartInfo.id }) }}" class="btn btn-primary">Buy Now</a>
					      <button class="remove-cart-button" data-cart-id="{{ cartInfo.id }}">Remove product</button>
              </div>
            </div>
          </div>
        </div>
      </div>
		  {% set count = count + 1 %}
	    {% endfor %}
      <div class="card mb-4">
        <div class="card-body p-4 d-flex flex-row">
          <div class="form-outline flex-fill">
            <input type="text" id="form1" class="form-control form-control-lg" />
            <label class="form-label" for="form1">Discound code</label>
          </div>
          <button type="button" class="btn btn-outline-warning btn-lg ms-3">Apply</button>
        </div>
      </div>
        <div class="card">
          <div class="card-body">
            <button type="button" class="btn btn-warning btn-block btn-lg">Proceed to Pay</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
{# <h2>My Carts</h2>
<div class="d-inline-flex p-2">
	{% set count = 0 %}

	{% for cartInfo in myCartsInfo %}
     <div class="cart-item" data-cart-id="{{ cartInfo.id }}">
		<div class="card" style="width: 14rem; margin-right: 1rem">
			<img src="{{ asset('users_data/' ~ myCartsDirImages[count]['id'] ~ '/products/' ~ myCartsDirImages[count]['dir'] ~ '/' ~ myCartsDirImages[count]['images'][0] ) }}" class="card-img-top" alt="...">
			<div class="card-body">
				<h5 class="card-title">{{ cartInfo.name }}</h5>
				<p class="card-text">Price:
					{{ cartInfo.price }}</p>
				<a href="{{ path('app_check_product', { 'id': cartInfo.id }) }}" class="btn btn-primary">Check product</a>
					<button class="remove-cart-button" data-cart-id="{{ cartInfo.id }}">Remove product</button>
			</div>
		</div>
    </div>
		{% set count = count + 1 %}
      
	{% endfor %}
</div> #}

{% block javascripts %}
    <script type="text/javascript">
      $(document).on('click', '.remove-cart-button', function(event){
    var productId = $(this).data('cart-id');
	var quantity = $('#quantity-input').val();
    $.ajax({
      url: '{{ path('ajax_remove_cart') }}',
      method: 'POST',
      data: {productId: productId, quantity: quantity},
      success: function(response) {
        
			$('.show-cart-count').html(response.cartsCount);
        	$('.cart-item[data-cart-id="' + productId + '"]').remove();
			$('[data-cart-id="' + productId + '"]').removeClass('remove-cart-button').addClass('add-cart-button').text('Add product');

      
	  }
    });
  });


  $(document).ready(function() {
  updateTotal();
  
  $('.quantity-input').on('change', function() {
    updateTotal();
  });
});

function updateTotal() {
  $('.quantity-input').each(function() {
    var displayId = $(this).data('display');
    var quantity = $(this).val();
    var price = $(this).data('price');
    $(displayId).text('$' + (quantity * price).toFixed(2));
  });
}
    </script>
{% endblock %}

{% endblock %}
