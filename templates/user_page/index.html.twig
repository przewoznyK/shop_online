{% extends 'base.html.twig' %}

{% block title %}Hello UserPageController!
{% endblock %}

{% block body %}

	{% for message in app.flashes('success') %}
		<div class='alert alert-success'>
			{{ message }}
		</div>
	{% endfor %}
	{% for message in app.flashes('error') %}
		<div class='alert alert-danger'>
			{{ message }}
		</div>
	{% endfor %}
	<div class="example-wrapper">
		{% if is_granted('IS_AUTHENTICATED_FULLY') %}
			<div class='text-center mt-5'>
				{% if myPageBool %}
					<a href='{{ path('app_delete_account') }}'>
						<div class='btn btn-danger'>Delete account</div>
					</a>
					{{ form_start(editProfile) }}
					{{ form_row(editProfile.description) }}
					{{ form_row(editProfile.avatar) }}
					<button type="submit" class="btn">Save</button>
					{{ form_end(editProfile) }}
				{% endif %}
			{% endif %}
			<img src="{{ asset('users_data/' ~ userId ~ '/avatar/avatar.jpg') }}" alt="ACME logo" class="img-fluid img-thumbnail rounded" width='100px'>
			<h1>{{ username }}</h1>
			<br><br>
			{# Carts #}

			<div class="container px-4 px-lg-5 mt-5 mx-auto">
				<div class="row gx-4 gx-lg-5 row-cols-2 row-cols-md-3 row-cols-xl-4 justify-content-center">
					<div class="col mb-5">
						<div
							class="card h-100">
							<!-- Product image-->
							<img
							src="{{ asset('tools/plus.png') }}" class="card-img-top" alt="...">
							<!-- Product details-->
							<div class="card-body p-4">
								<div
									class="text-center">
									<!-- Product name-->
									<a href="{{ path('app_create_product') }}">
										<p class='btn btn-success'>Add Product</p>
									</a>
									<!-- Product price-->

								</div>
							</div>
							<!-- Product actions-->
							{# <div class="card-footer p-4 pt-0 border-top-0 bg-transparent d-flex align-items-center justify-content-center">
																		<a href="{{ path('app_check_product', { 'id': product.id }) }}" class="btn btn-primary">Check product</a>
																		{% if myPageBool %}
																			<div data-id={{ product.id }} class="btn btn-danger delete-product">Delete product</div>
																		{% endif %}
																	</div> #}
						</div>
					</div>
					{% set count = 0 %}
					{% for product in productUser %}
						<div class="col mb-5">
							<div
								class="card h-100">
								<!-- Product image-->
								<img
								src="{{ asset('users_data/' ~ userId ~ '/products/' ~ files[count]['dir'] ~ '/' ~ files[count]['images'][0] ) }}" class="card-img-top" alt="...">
								<!-- Product details-->
								<div class="card-body p-4">
									<div
										class="text-center">
										<!-- Product name-->
										<h5 class="fw-bolder">{{ product.name }}</h5>
										<!-- Product price-->
										{{ product.price }}$
									</div>
								</div>
								<!-- Product actions-->
								<div class="card-footer p-4 pt-0 border-top-0 bg-transparent d-flex align-items-center justify-content-center">
									<a href="{{ path('app_check_product', { 'id': product.id }) }}" class="btn btn-primary">Check</a>
									{% if myPageBool %}
									<a href="{{ path('app_edit_product', {'id': product.id }) }}"><div class='btn btn-secondary m-1'> Edit </div></a>
										<div data-id={{ product.id }} class="btn btn-danger delete-product">Delete</div>

									{% endif %}
								</div>
							</div>
						</div>
						{% set count = count + 1 %}
					{% endfor %}
			</div>
		</div>

	</div>
</div>

<h2>My Offerts</h2>
<br>
<div class="d-inline-flex p-2">
	{% set count = 0 %}
	{% for product in productUser %}
		<div class="card offer-field" data-id='{{ product.id }}' style="width: 14rem; margin-right: 1rem">
			<img src="{{ asset('users_data/' ~ userId ~ '/products/' ~ files[count]['dir'] ~ '/' ~ files[count]['images'][0] ) }}" class="card-img-top" alt="...">
			<div class="card-body">
				<h5 class="card-title">{{ product.name }}</h5>
				<p class="card-text">Price:
					{{ product.price }}</p>
				<a href="{{ path('app_check_product', { 'id': product.id }) }}" class="btn btn-primary">Check product</a>
				{% if myPageBool %}
					<div data-id={{ product.id }} class="btn btn-error delete-product">Delete product</div>

				{% endif %}
			</div>
		</div>
		{% set count = count + 1 %}
	{% endfor %}
	{% if myPageBool %}
	</div>
</div>
{{ myCartsInfo|length }}
<br>
<h2>My Carts</h2>
<div class="d-inline-flex p-2">
	{% set count = 0 %}
	{% for cartInfo in myCartsInfo %}
		<div class="card" style="width: 14rem; margin-right: 1rem">
			<img src="{{ asset('users_data/' ~ myCartsDirImages[count]['id'] ~ '/products/' ~ myCartsDirImages[count]['dir'] ~ '/' ~ myCartsDirImages[count]['images'][0] ) }}" class="card-img-top" alt="...">
			<div class="card-body">
				<h5 class="card-title">{{ cartInfo.name }}</h5>
				<p class="card-text">Price:
					{{ cartInfo.price }}</p>
				<a href="{{ path('app_check_product', { 'id': cartInfo.id }) }}" class="btn btn-primary">Check product</a>
			</div>
		</div>
		{% set count = count + 1 %}
	{% endfor %}
{% else %}
	<i class="bi bi-person-circle">ss</i>
{% endif %}</div><script>
$(document).on('click', '.delete-product', function () {
id = $(this).data('id');
$.ajax({
url: '{{ path('ajax_delete_product') }}',
method: 'POST',
data: {
id: id
},
success: function (response) {
console.log(response.id);
$('.offer-field[data-id=' + id + ']').remove();
}
})
})</script>{% endblock %}
